#/usr/bin/env bash
PACKAGE="daa041dc-a533-439a-bad6-1aa587dc4290"
DATASET="1bd84670-055a-11e5-aaa2-0346bb21d5a1"
NET="f6f613f6-5968-4858-819c-297533c89546"

STACK=`fifo groupings create --type stack cluster-test-stack | awk '{print $4}'`
CLUSTER=`fifo groupings create --type cluster cluster-test-cluster | awk '{print $4}'`

fifo groupings add $STACK cluster $CLUSTER

./scm_add_autoscale_var $CLUSTER target 10
./scm_add_autoscale_var $CLUSTER package $PACKAGE
./scm_add_autoscale_var $CLUSTER dataset $DATASET
./scm_add_autoscale_var $CLUSTER template.networks.net0 $NET
./scm_add_autoscale_var $CLUSTER template.domain "cluster-test-vm"
#./scm_add_autoscale_var $CLUSTER template.grouping $CLUSTER
./rescale $CLUSTER

# for i in {1..4}
# do
#   cat <<EOF | fifo vms create -p $PACKAGE -d $DATASET
#   {
#     "alias": "cluster-test-vm${i}",
#     "networks": {"net0": "$NET"}
#   }
# EOF
# 	UUID=`fifo vms list | grep cluster-test-vm$i | awk '{print $1}'`
# 	sleep 45
# 	./fifo/fake_grouping "sniffle@172.16.2.70" erlang $CLUSTER $UUID
# done






# {1..7}
#
#
#
# fifo groupings list -H | awk '{print $1}' | xargs -n 1 -I {} fifo groupings get {}